# 🔧 스마트 관개 시스템 하드웨어 구축 가이드

## 📋 목차
1. [필요한 부품 목록](#1-필요한-부품-목록)
2. [회로 연결 단계별 가이드](#2-회로-연결-단계별-가이드)
3. [센서 보정 절차](#3-센서-보정-절차)
4. [시스템 테스트](#4-시스템-테스트)
5. [문제 해결](#5-문제-해결)

---

## 1. 필요한 부품 목록

### 필수 부품 ✅

| 부품명 | 수량 | 용도 | 예상 가격 |
|--------|------|------|-----------|
| **아두이노 우노 R3** | 1개 | 메인 컨트롤러 | 5,000~8,000원 |
| **토양 수분 센서** | 2개 | 상단/하단 수분 측정 | 각 1,000원 |
| **DHT11 온습도 센서** | 1개 | 온도/습도 측정 | 2,000원 |
| **릴레이 모듈 (5V 1채널)** | 1개 | 펌프/밸브 제어 | 1,500원 |
| **12V DC 워터 펌프** | 1개 | 물 공급 | 3,000~5,000원 |
| **12V 전자 밸브 (솔레노이드)** | 1개 | 물 차단/개방 | 5,000~8,000원 |
| **12V 어댑터** | 1개 | 펌프/밸브 전원 | 3,000원 |
| **USB 케이블 (A to B)** | 1개 | 아두이노 전원 + 통신 | 1,000원 |
| **점퍼 와이어 (M-M, M-F)** | 1세트 | 부품 연결 | 2,000원 |
| **브레드보드** | 1개 | 회로 구성 | 1,500원 |

**총 예상 비용: 약 25,000~35,000원**

### 선택 부품 (권장) ⭐

| 부품명 | 용도 | 가격 |
|--------|------|------|
| **10K 저항** (1개) | DHT11 풀업 저항 | 100원 |
| **플라스틱 케이스** | 회로 보호 | 3,000원 |
| **실리콘 튜브 (호스)** | 물 이동 | 1,000원 |
| **물통 (2L)** | 저수조 | 1,000원 |

---

## 2. 회로 연결 단계별 가이드

### ⚠️ 작업 전 주의사항
- **전원을 먼저 연결하지 마세요!** 모든 연결 완료 후 전원 투입
- 극성(+/-)을 반드시 확인하세요
- 물과 전기를 분리하세요 (방수 처리 필수)

---

### 🔌 STEP 1: 토양 수분 센서 연결 (2개)

#### 센서 1 (상단) - A0 핀
```
토양센서1
├─ VCC  →  아두이노 5V
├─ GND  →  아두이노 GND
└─ A0   →  아두이노 A0
```

#### 센서 2 (하단) - A1 핀
```
토양센서2
├─ VCC  →  아두이노 5V
├─ GND  →  아두이노 GND
└─ A0   →  아두이노 A1
```

**작업 순서:**
1. 브레드보드에 5V와 GND 레일 설정
2. 아두이노 5V → 브레드보드 (+) 레일
3. 아두이노 GND → 브레드보드 (-) 레일
4. 각 센서의 VCC를 (+) 레일에 연결
5. 각 센서의 GND를 (-) 레일에 연결
6. 센서1 DATA → A0, 센서2 DATA → A1

**확인 포인트:**
- [ ] 센서 전원 LED가 켜지는지 확인
- [ ] 핀이 느슨하지 않은지 확인

---

### 🌡️ STEP 2: DHT11 온습도 센서 연결

```
DHT11 센서
├─ VCC   →  아두이노 5V (또는 브레드보드 + 레일)
├─ GND   →  아두이노 GND (또는 브레드보드 - 레일)
├─ DATA  →  아두이노 D4
└─ [옵션] DATA와 VCC 사이에 10K 저항 연결 (풀업)
```

**DHT11 핀 배치 (정면 기준):**
```
┌─────┐
│ DHT │
│ 11  │
└─┬─┬─┬─┘
  1 2 3 4
  │ │ │ └─ NC (사용 안 함)
  │ │ └─── GND
  │ └───── DATA (D4)
  └─────── VCC (5V)
```

**작업 순서:**
1. DHT11 VCC → 브레드보드 (+)
2. DHT11 GND → 브레드보드 (-)
3. DHT11 DATA → 아두이노 D4
4. (권장) 10K 저항을 DATA-VCC 사이에 연결

**확인 포인트:**
- [ ] 핀 번호 확인 (DHT11은 모델마다 핀 순서가 다를 수 있음)
- [ ] 극성 확인

---

### ⚡ STEP 3: 릴레이 모듈 연결

```
릴레이 모듈 (제어 신호)
├─ VCC  →  아두이노 5V
├─ GND  →  아두이노 GND
└─ IN   →  아두이노 D2

릴레이 모듈 (전원 스위칭)
├─ COM  →  12V 어댑터 (+)
├─ NO   →  전자밸브 (+)  ← 평상시 열림(Normally Open)
└─ NC   →  사용 안 함
```

**작업 순서:**
1. 릴레이 VCC → 아두이노 5V
2. 릴레이 GND → 아두이노 GND
3. 릴레이 IN → 아두이노 D2
4. **전원 연결은 STEP 5에서 진행**

**릴레이 모듈 설명:**
- **COM**: 공통 단자 (12V 입력)
- **NO (Normally Open)**: 평상시 열림 → 신호 ON 시 연결
- **NC (Normally Closed)**: 평상시 닫힘 → 사용하지 않음

**확인 포인트:**
- [ ] 릴레이 전원 LED 확인
- [ ] NO/NC 단자 구분 확인

---

### 💧 STEP 4: 펌프와 전자밸브 연결

#### 회로 구성 (직렬 연결)
```
12V 어댑터(+) → 릴레이 COM
릴레이 NO → 전자밸브(+)
전자밸브(-) → 펌프(+)
펌프(-) → 12V 어댑터(-)
```

**작업 순서:**
1. 전자밸브와 펌프를 호스로 연결
2. 전자밸브 입구 → 물통
3. 펌프 출구 → 화분/토양
4. 전선 연결:
   - 릴레이 COM에 12V(+) 연결
   - 릴레이 NO에 전자밸브(+) 연결
   - 전자밸브(-)와 펌프(+) 연결
   - 펌프(-)에 12V(-) 연결

**극성 확인:**
- 전자밸브: 극성 무관 (AC 방식도 있음, DC는 극성 있음)
- 펌프: **반드시 극성 확인** (반대로 하면 역회전)

**확인 포인트:**
- [ ] 호스 연결 누수 확인
- [ ] 펌프 방향 확인 (화살표 표시)
- [ ] 전선이 물에 닿지 않도록 방수 처리

---

### 🔋 STEP 5: 전원 연결

#### 전원 구성
```
[PC/노트북 USB] → 아두이노 (5V, 통신)
[12V 어댑터] → 릴레이 COM (펌프/밸브)
```

**작업 순서:**
1. **먼저 모든 연결 재확인!**
2. USB 케이블로 아두이노와 PC 연결
3. 12V 어댑터를 릴레이 COM과 펌프 회로에 연결
4. **12V 어댑터는 마지막에 꽂기**

**⚠️ 주의:**
- 아두이노 5V와 12V 어댑터를 절대 직접 연결하지 마세요
- GND는 공통이지만, 전원은 분리되어야 합니다

---

### 📊 최종 회로도

```
┌─────────────────────────────────────────────────────────┐
│                    아두이노 우노 R3                        │
│                                                           │
│  A0 ←─── 토양센서1 (상단)                                 │
│  A1 ←─── 토양센서2 (하단)                                 │
│  D4 ←─── DHT11 (온습도)                                   │
│  D2 ───→ 릴레이 IN                                        │
│                                                           │
│  5V ───┬─→ 센서들 VCC                                     │
│        └─→ 릴레이 VCC                                     │
│  GND ──┬─→ 센서들 GND                                     │
│        └─→ 릴레이 GND                                     │
│                                                           │
│  USB ←───────── PC (전원 + 통신)                          │
└─────────────────────────────────────────────────────────┘
                           │
                           │ D2 신호
                           ↓
                    ┌──────────────┐
                    │  릴레이 모듈  │
                    │              │
                    │  COM ← 12V(+)│
                    │  NO  → 밸브  │
                    └──────────────┘
                           │
                           ↓
                    전자밸브(+)
                           │
                           ↓
                    전자밸브(-)
                           │
                           ↓
                    펌프(+)
                           │
                           ↓
                    펌프(-) → 12V(-)

물의 흐름: 물통 → 전자밸브 → 펌프 → 화분
```

---

## 3. 센서 보정 절차

### 🎯 토양 수분 센서 보정

센서마다 값이 다르므로 **반드시 보정 필요**합니다.

#### 보정 단계:

**1단계: 건조 상태 측정**
```cpp
// 아두이노 코드 업로드 후 시리얼 모니터 열기
// 센서를 공기 중에 노출
// "TEST" 입력하여 값 확인
// 예: 950 → 이 값을 SOIL_DRY에 입력
```

**2단계: 습윤 상태 측정**
```cpp
// 센서를 물에 담그기 (센서 끝부분만, 회로 부분은 X)
// "TEST" 입력하여 값 확인
// 예: 250 → 이 값을 SOIL_WET에 입력
```

**3단계: 코드 수정**
```cpp
// smart_irrigation.ino 파일 수정
const int SOIL_DRY = 950;  // 1단계에서 측정한 값
const int SOIL_WET = 250;  // 2단계에서 측정한 값
```

**4단계: 재업로드 및 확인**
```
다시 업로드 → "TEST" 입력 → 수분 %가 정상적으로 표시되는지 확인
- 공기 중: 0~10%
- 물 속: 90~100%
```

---

### 🌡️ DHT11 센서 확인

DHT11은 보정이 필요 없지만 작동 확인은 필수입니다.

**확인 방법:**
```
시리얼 모니터에서 "TEST" 입력
→ TEMP: 25.0°C, HUMID: 60.0% 같은 값이 나오면 정상
→ "ERROR:DHT_READ_FAILED" 나오면 연결 재확인
```

**일반적인 DHT11 문제:**
- 데이터 핀 잘못 연결
- 10K 풀업 저항 없음 (일부 모듈은 내장)
- 전원 부족

---

## 4. 시스템 테스트

### 📝 테스트 체크리스트

#### Phase 1: 하드웨어 단독 테스트

**1. 센서 읽기 테스트**
```
[ ] 아두이노 IDE 시리얼 모니터 열기 (9600 baud)
[ ] "TEST" 입력
[ ] 센서 데이터가 정상적으로 출력되는지 확인
    예: SOIL_UP:45.2,SOIL_LOW:48.5,TEMP:25.3,HUMID:60.5
```

**2. 릴레이 테스트**
```
[ ] "WATER_ON:5" 입력 (5초 급수)
[ ] 릴레이 LED 켜지는지 확인
[ ] "딸깍" 소리 들리는지 확인
[ ] 5초 후 자동으로 릴레이 OFF 확인
```

**3. 펌프 테스트**
```
[ ] 물통에 물 넣기
[ ] "WATER_ON:10" 입력
[ ] 펌프가 작동하는지 확인
[ ] 물이 실제로 나오는지 확인
[ ] 전자밸브가 열리는지 확인
```

**4. 긴급 정지 테스트**
```
[ ] "WATER_ON:60" 입력
[ ] 급수 중 "WATER_OFF" 입력
[ ] 즉시 멈추는지 확인
```

---

#### Phase 2: Python 연동 테스트

**1. 포트 확인**
```bash
# Windows
장치 관리자 → 포트(COM & LPT) → "Arduino Uno (COM3)" 확인

# Mac/Linux
ls /dev/tty.*
# 예: /dev/ttyUSB0 또는 /dev/tty.usbmodem14201
```

**2. main.py 수정**
```python
# main.py 18번째 줄 수정
SERIAL_PORT = 'COM3'  # Windows
# 또는
SERIAL_PORT = '/dev/ttyUSB0'  # Linux/Mac
```

**3. 실행**
```bash
cd /Users/baghyeonbin/그린스마트팜\ 해커톤/project
python main.py --real
```

**4. 확인 사항**
```
[ ] "[시리얼] COM3 연결 성공" 메시지 확인
[ ] 5분마다 센서 데이터 수신 확인
[ ] AI 예측 후 자동 급수 작동 확인
```

---

#### Phase 3: 통합 테스트

**시나리오 1: 건조 시 자동 급수**
```
1. 토양 센서를 건조한 곳에 배치
2. Python 프로그램 실행
3. 예측값이 35% 미만이면 자동 급수 확인
```

**시나리오 2: 습윤 시 급수 안 함**
```
1. 토양 센서를 물에 담그기
2. Python 프로그램 실행
3. "수분 충분 - 급수 불필요" 메시지 확인
```

---

## 5. 문제 해결

### ❌ 문제 1: "포트를 찾을 수 없습니다"

**원인:**
- USB 케이블 불량
- 드라이버 미설치
- 포트 이름 오류

**해결:**
```bash
# 1. 케이블 재연결
# 2. 드라이버 설치 (Windows)
https://www.arduino.cc/en/software

# 3. 포트 확인
python -m serial.tools.list_ports
```

---

### ❌ 문제 2: "ERROR:DHT_READ_FAILED"

**원인:**
- DHT11 연결 불량
- 전원 부족
- 불량 센서

**해결:**
```
1. 연결 재확인 (VCC, GND, DATA)
2. 10K 저항 추가
3. 다른 DHT11로 교체
4. DHT11 라이브러리 재설치
```

---

### ❌ 문제 3: 릴레이는 작동하는데 펌프가 안 돌아감

**원인:**
- 12V 전원 부족
- 펌프 극성 반대
- 전자밸브 막힘

**해결:**
```
1. 12V 어댑터 전압 확인 (멀티미터)
2. 펌프 극성 바꿔보기
3. 전자밸브를 제거하고 펌프만 테스트
4. 호스 막힘 확인
```

---

### ❌ 문제 4: 센서 값이 이상함 (항상 0% 또는 100%)

**원인:**
- 센서 보정 안 됨
- 센서 고장
- 연결 불량

**해결:**
```
1. 센서 보정 다시 진행
2. 센서를 공기 중/물 속에서 테스트
3. A0, A1 핀 재확인
4. 다른 센서로 교체
```

---

### ❌ 문제 5: Python 프로그램이 데이터를 못 받음

**원인:**
- 시리얼 포트 충돌
- 아두이노 시리얼 모니터 열려 있음
- Baud rate 불일치

**해결:**
```python
# 1. 아두이노 시리얼 모니터 닫기
# 2. Python 코드 확인
serial.Serial(port, 9600, timeout=1)  # 9600 확인

# 3. 권한 문제 (Linux)
sudo chmod 666 /dev/ttyUSB0
```

---

## 🎯 해커톤 당일 체크리스트

### 출발 전 확인 ✅
```
[ ] 아두이노 우노
[ ] USB 케이블
[ ] 토양센서 2개
[ ] DHT11
[ ] 릴레이 모듈
[ ] 펌프
[ ] 전자밸브
[ ] 12V 어댑터
[ ] 점퍼선 세트
[ ] 브레드보드
[ ] 물통 + 물
[ ] 호스
[ ] 테스트용 화분/흙
[ ] 노트북 (Python 환경 설치됨)
[ ] 예비 부품 (센서, 점퍼선)
```

### 현장 조립 순서 (30분)
```
1. [5분] 브레드보드에 센서 연결
2. [5분] DHT11 연결
3. [5분] 릴레이 연결
4. [10분] 펌프+밸브 회로 연결
5. [5분] 센서 보정
```

### 시연 준비 (10분)
```
1. Python 프로그램 실행
2. 건조 센서 시연 → 자동 급수
3. 그래프 보여주기
4. 예측 정확도 설명
```

---

## 📚 참고 자료

### 아두이노 라이브러리 설치
```
Arduino IDE → 스케치 → 라이브러리 포함하기 → 라이브러리 관리
→ "DHT sensor library" 검색 → 설치
```

### Python 라이브러리 설치
```bash
pip install pyserial pandas numpy scikit-learn matplotlib
```

### 긴급 연락처 (해커톤 당일)
- 아두이노 문제: [멘토 이름]
- Python 문제: [멘토 이름]
- 하드웨어 고장: 예비 부품 사용

---

**작성일:** 2024-12-09
**팀:** 내가 그린 스마트팜
**대회:** 2025 SCNU 그린스마트팜 청소년 해커톤

---

### 🚀 마지막 팁

1. **연습이 중요합니다!** 최소 2번은 조립 → 분해 → 재조립 연습하세요.
2. **예비 부품을 준비하세요.** 센서는 고장나기 쉽습니다.
3. **방수 처리를 확실히 하세요.** 물과 전기는 최악의 조합입니다.
4. **영상을 촬영하세요.** 물이 나오는 장면은 시연 실패 시 대체 자료로 사용 가능합니다.

**행운을 빕니다! 🍀**
